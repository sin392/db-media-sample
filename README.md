# 概要

# アーキテクチャ
クリーンアーキテクチャを採用。内側の層が外部に依存することは許可されません。

- infrastructure ... 技術詳細に関するコード置き場 ex. DB, WEBフレームワーク
  - router ... パスやメソッドなどプロトコルに依存するリクエストを一般的な形式に変換して変換してコントローラにルーティングする
    - リクエストのパース処理（技術依存）
    - レスポンスの構成（技術依存）
- adapter ... 外部とのやり取りの接点となるコード置き場
  - controller ... routerから受け取ったリクエストをハンドラ（usecase）にルーティングする。バリデーションはここで行う
    - バリデーション（技術非依存）
    - 対応しているユースケースごとにコントローラを分けている（必要か？）
  - presenter ... controllerがレスポンスを返す際に、usecaseからのレスポンスの変換などを行う
  - repositoryimpl ... ドメインモデルの参照・操作の実装に関連するコード置き場
- usecase ... ビジネスロジックに関するコード置き場
    - usecaseごとにファイルを分けている
- domain ... ドメインロジックに関するコード置き場
  - model ... ドメインモデルに関するコード置き場
  - repository ... ドメインモデルに対する参照・操作の定義置き場

![sampleのアーキテクチャ図](sample/docs/graph/deps.png)

# 動作確認について
docker-composeで各サービスを起動できます。
注: 複数のモジュールを変更している場合、composeの実行時に各モジュールのコンテナで他のモジュールをimportしている場合にはローカルではなくリモートリポジトリの状況を参照するため、事前に変更のチェックインした後にgo.modで参照バージョンを更新する必要があります。
（go.workの設定をdocker-composeにも反映しようとしたがairと両立させるのが難しくて断念）

# 参考
- protoをdtoに変換すべきかの議論
  - ref: https://www.reddit.com/r/golang/comments/rdkqwv/grpc_use_the_generated_proto_as_a_model/
  - protoを完全にアプリケーション内のモデルとして利用すべきという意見もあるのか...
    - トランスポート専用じゃないよという主張はわかるけど全体が技術依存になるし、他のライブラリのサポート受けられなくなるケース多そう
  - 半構造化データをなるべく構造保った状態でRDBに保存する方法としてprotobufを使う場合もあるとか
    - ref: https://tech.layerx.co.jp/entry/2023/11/16/140041
